!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.qviz=e():t.qviz=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.regLineStart=e.argsFontSize=e.labelFontSize=e.controlBtnRadius=e.controlBtnOffset=e.nestedGroupPadding=e.groupBoxPadding=e.classicalRegHeight=e.registerHeight=e.labelPadding=e.gatePadding=e.gateHeight=e.minGateWidth=e.startY=e.startX=e.leftPadding=void 0,e.leftPadding=20,e.startX=80,e.startY=40,e.minGateWidth=40,e.gateHeight=40,e.gatePadding=10,e.labelPadding=10,e.registerHeight=e.gateHeight+2*e.gatePadding,e.classicalRegHeight=e.gateHeight,e.groupBoxPadding=e.gatePadding,e.nestedGroupPadding=2,e.controlBtnOffset=40,e.controlBtnRadius=15,e.labelFontSize=14,e.argsFontSize=12,e.regLineStart=40},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GateType=void 0,function(t){t[t.Measure=0]="Measure",t[t.Cnot=1]="Cnot",t[t.Swap=2]="Swap",t[t.X=3]="X",t[t.Unitary=4]="Unitary",t[t.ControlledUnitary=5]="ControlledUnitary",t[t.ClassicalControlled=6]="ClassicalControlled",t[t.Group=7]="Group",t[t.Invalid=8]="Invalid"}(e.GateType||(e.GateType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegisterType=void 0,function(t){t[t.Qubit=0]="Qubit",t[t.Classical=1]="Classical"}(e.RegisterType||(e.RegisterType={}))},function(t,e,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),a=0;for(e=0;e<n;e++)for(var i=arguments[e],l=0,o=i.length;l<o;l++,a++)r[a]=i[l];return r};Object.defineProperty(e,"__esModule",{value:!0}),e.dashedBox=e.dashedLine=e.arc=e.text=e.box=e.line=e.controlDot=e.group=void 0;var a=n(0);e.group=function(t,e){void 0===e&&(e={});var n=Object.entries(e).filter((function(t){t[0];return null!=t[1]})).map((function(t){return t[0]+"='"+t[1]+"'"})).join(" ");return r(["<g "+n+">"],t.flat(),["</g>"]).join("\n")},e.controlDot=function(t,e,n){return void 0===n&&(n=5),'<circle class="control-dot" cx="'+t+'" cy="'+e+'" r="'+n+'"></circle>'},e.line=function(t,e,n,r,a){return"<line"+(null!=a?' class="'+a+'"':"")+' x1="'+t+'" x2="'+n+'" y1="'+e+'" y2="'+r+'"></line>'},e.box=function(t,e,n,r,a){return void 0===a&&(a="gate-unitary"),'<rect class="'+a+'" x="'+t+'" y="'+e+'" width="'+n+'" height="'+r+'"></rect>'},e.text=function(t,e,n,r){return void 0===r&&(r=a.labelFontSize),'<text font-size="'+r+'" x="'+e+'" y="'+n+'">'+t+"</text>"},e.arc=function(t,e,n,r){return'<path class="arc-measure" d="M '+(t+2*n)+" "+e+" A "+n+" "+r+" 0 0 0 "+t+" "+e+'"></path>'},e.dashedLine=function(t,e,n,r,a){return"<line"+(null!=a?' class="'+a+'"':"")+' x1="'+t+'" x2="'+n+'" y1="'+e+'" y2="'+r+'" stroke-dasharray="8, 8"></line>'},e.dashedBox=function(t,e,n,r,a){return"<rect"+(null!=a?' class="'+a+'"':"")+' x="'+t+'" y="'+e+'" width="'+n+'" height="'+r+'" fill-opacity="0" stroke-dasharray="8, 8"></rect>'}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConditionalRender=void 0,function(t){t[t.Always=0]="Always",t[t.OnZero=1]="OnZero",t[t.OnOne=2]="OnOne",t[t.AsGroup=3]="AsGroup"}(e.ConditionalRender||(e.ConditionalRender={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._getStringWidth=e.getGateWidth=e.createUUID=void 0;var r=n(1),a=n(0);e.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))};e.getGateWidth=function(t){var e=t.type,n=t.label,l=t.displayArgs,o=t.width;if(o>0)return o;switch(e){case r.GateType.Measure:case r.GateType.Cnot:case r.GateType.Swap:return a.minGateWidth;default:var s=i(n),c=null!=l?i(l,a.argsFontSize):0,u=Math.max(s,c)+2*a.labelPadding;return Math.max(a.minGateWidth,u)}};var i=function(t,e){void 0===e&&(e=a.labelFontSize);var n=document.createElement("canvas").getContext("2d");if(null==n)throw new Error("Null canvas");return n.font=e+"px Arial",n.measureText(t).width};e._getStringWidth=i},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.style=e.STYLES=void 0;var a={lineStroke:"#000000",lineWidth:1,textColour:"#000000",unitary:"#D9F1FA",oplus:"#FFFFFF",measure:"#FFDE86",classicalUnknown:"#E5E5E5",classicalZero:"#C40000",classicalOne:"#4059BD",classicalZeroText:"#FFFFFF",classicalOneText:"#FFFFFF"};e.STYLES={Default:a,BlackAndWhite:{lineStroke:"#000000",lineWidth:1,textColour:"#000000",unitary:"#FFFFFF",oplus:"#FFFFFF",measure:"#FFFFFF",classicalUnknown:"#FFFFFF",classicalZero:"#000000",classicalOne:"#000000",classicalZeroText:"#FFFFFF",classicalOneText:"#FFFFFF"},Inverted:{lineStroke:"#FFFFFF",lineWidth:1,textColour:"#FFFFFF",unitary:"#000000",oplus:"#000000",measure:"#000000",classicalUnknown:"#000000",classicalZero:"#FFFFFF",classicalOne:"#FFFFFF",classicalZeroText:"#000000",classicalOneText:"#000000"}},e.style=function(t){void 0===t&&(t={});var e=r(r({},a),t);return"\n<style>\n    line,\n    circle,\n    rect {\n        stroke: "+e.lineStroke+";\n        stroke-width: "+e.lineWidth+";\n    }\n    text {\n        fill: "+e.textColour+";\n        dominant-baseline: middle;\n        text-anchor: middle;\n        font-family: Arial;\n    }\n    .control-dot {\n        fill: "+e.lineStroke+";\n    }\n    .oplus line, .oplus circle {\n        fill: "+e.oplus+";\n        stroke-width: 2;\n    }\n    .gate-unitary {\n        fill: "+e.unitary+";\n    }\n    .gate-measure {\n        fill: "+e.measure+";\n    }\n    rect.gate-swap {\n        fill: transparent;\n        stroke: transparent;\n    }\n    .arc-measure {\n        stroke: "+e.lineStroke+";\n        fill: none;\n        stroke-width: "+e.lineWidth+";\n    }\n    .register-classical {\n        stroke-width: "+(e.lineWidth||0)/2+";\n    }\n    \x3c!-- Classically controlled gates --\x3e\n    .hidden {\n        display: none;\n    }\n    .classically-controlled-unknown {\n        opacity: 0.25;\n    }\n    \x3c!-- Gate outline --\x3e\n    .classically-controlled-one .classical-container,\n    .classically-controlled-one .classical-line {\n        stroke: "+e.classicalOne+";\n        stroke-width: "+((e.lineWidth||0)+.3)+";\n        fill: "+e.classicalOne+";\n        fill-opacity: 0.1;\n    }\n    .classically-controlled-zero .classical-container,\n    .classically-controlled-zero .classical-line {\n        stroke: "+e.classicalZero+";\n        stroke-width: "+((e.lineWidth||0)+.3)+";\n        fill: "+e.classicalZero+";\n        fill-opacity: 0.1;\n    }\n    \x3c!-- Control button --\x3e\n    .classically-controlled-btn {\n        cursor: pointer;\n    }\n    .classically-controlled-unknown .classically-controlled-btn {\n        fill: "+e.classicalUnknown+";\n    }\n    .classically-controlled-one .classically-controlled-btn {\n        fill: "+e.classicalOne+";\n    }\n    .classically-controlled-zero .classically-controlled-btn {\n        fill: "+e.classicalZero+";\n    }\n    \x3c!-- Control button text --\x3e\n    .classically-controlled-btn text {\n        dominant-baseline: middle;\n        text-anchor: middle;\n        stroke: none;\n        font-family: Arial;\n    }\n    .classically-controlled-unknown .classically-controlled-btn text {\n        fill: "+e.textColour+";\n    }\n    .classically-controlled-one .classically-controlled-btn text {\n        fill: "+e.classicalOneText+";\n    }\n    .classically-controlled-zero .classically-controlled-btn text {\n        fill: "+e.classicalZeroText+";\n    }\n\n    .qviz .gate-collapse,\n    .qviz .gate-expand {\n        opacity: 0;\n        transition: opacity 1s;\n    }\n\n    .qviz:hover .gate-collapse,\n    .qviz:hover .gate-expand {\n        visibility: visible;\n        opacity: 0.2;\n        transition: visibility 1s;\n        transition: opacity 1s;\n    }\n\n    .gate-expand, .gate-collapse {\n        cursor: pointer;\n    }\n\n    .gate-collapse circle,\n    .gate-expand circle {\n        fill: white;\n        stroke-width: 2px;\n        stroke: black;\n    }\n    .gate-collapse path,\n    .gate-expand path {\n        stroke-width: 4px;\n        stroke: black;\n    }\n\n    .gate:hover > .gate-collapse,\n    .gate:hover > .gate-expand {\n        visibility: visible;\n        opacity: 1;\n        transition: opacity 1s;\n    }\n</style>\n"}},function(t,e,n){t.exports=n(8)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.draw=void 0;var r=n(9);e.draw=function(t,e,n,a){void 0===n&&(n={}),void 0===a&&(a=0),new r.Sqore(t,n).draw(e,a)};var a=n(6);Object.defineProperty(e,"STYLES",{enumerable:!0,get:function(){return a.STYLES}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sqore=void 0;var r=n(10),a=n(11),i=n(12),l=n(13),o=n(4),s=n(1),c=n(6),u=n(5),d=function(){function t(t,e){void 0===e&&(e={}),this.style={},this.gateRegistry={},this.circuit=t,this.style=this.getStyle(e)}return t.prototype.draw=function(t,e){var n=this;if(void 0===e&&(e=0),null==t)throw new Error("Container not provided.");var r=JSON.parse(JSON.stringify(this.circuit));if(r.operations.forEach((function(t,e){return n.fillGateRegistry(t,e.toString())})),r.operations=this.selectOpsAtDepth(r.operations,e),1==r.operations.length&&null!=r.operations[0].dataAttributes&&r.operations[0].dataAttributes.hasOwnProperty("id")){var a=r.operations[0].dataAttributes.id;this.expandOperation(r.operations,a)}this.renderCircuit(t,r)},t.prototype.getStyle=function(t){if(void 0===t&&(t={}),"string"==typeof t||t instanceof String){var e=t;if(!c.STYLES.hasOwnProperty(e))return console.error("No style "+e+" found in STYLES."),{};t=c.STYLES[e]}return t},t.prototype.renderCircuit=function(t,e){var n=this.compose(e);t.innerHTML=this.generateSvg(n),this.addGateClickHandlers(t,e)},t.prototype.compose=function(t){var e,n,o=function(t,e){var n;Array.isArray(e)?e.forEach((function(e){return o(t,e)})):(t.push(e),null===(n=e.children)||void 0===n||n.forEach((function(e){return o(t,e)})))},c=t.qubits,u=t.operations,d=r.formatInputs(c),p=d.qubitWires,f=d.registers,g=d.svgHeight,h=l.processOperations(u,f),y=h.metadataList,v=h.svgWidth,x=a.formatGates(y),b=(e=y,n=[],o(n,e),n).filter((function(t){return t.type===s.GateType.Measure}));return{width:v,height:g,elements:[p,i.formatRegisters(f,b,v),x]}},t.prototype.generateSvg=function(t){return'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="'+u.createUUID()+'" class="qviz" width="'+t.width+'" height="'+t.height+'">\n    '+c.style(this.style)+"\n    "+t.elements.join("\n")+"\n</svg>"},t.prototype.fillGateRegistry=function(t,e){var n,r=this;null==t.dataAttributes&&(t.dataAttributes={}),t.dataAttributes.id=e,t.dataAttributes["zoom-out"]="false",this.gateRegistry[e]=t,null===(n=t.children)||void 0===n||n.forEach((function(t,n){r.fillGateRegistry(t,e+"-"+n),null==t.dataAttributes&&(t.dataAttributes={}),t.dataAttributes["zoom-out"]="true"})),t.dataAttributes["zoom-in"]=(null!=t.children).toString()},t.prototype.selectOpsAtDepth=function(t,e){var n=this;if(e<0)throw new Error("Invalid renderDepth of "+e+". Needs to be >= 0.");return 0===e?t:t.map((function(t){return null!=t.children?n.selectOpsAtDepth(t.children,e-1):t})).flat()},t.prototype.addGateClickHandlers=function(t,e){this.addClassicalControlHandlers(t),this.addZoomHandlers(t,e)},t.prototype.addClassicalControlHandlers=function(t){return null==t||t.querySelectorAll(".classically-controlled-btn").forEach((function(t){t.addEventListener("click",(function(e){var n,r=t.querySelector("text"),a=t.parentElement;if(null!=r&&null!=a){var i=null===(n=r.firstChild)||void 0===n?void 0:n.nodeValue,l=null==a?void 0:a.querySelector(".gates-zero"),o=null==a?void 0:a.querySelector(".gates-one");switch(i){case"?":r.childNodes[0].nodeValue="1",a.classList.remove("classically-controlled-unknown"),a.classList.remove("classically-controlled-zero"),a.classList.add("classically-controlled-one"),null==l||l.classList.add("hidden"),null==o||o.classList.remove("hidden");break;case"1":r.childNodes[0].nodeValue="0",a.classList.remove("classically-controlled-unknown"),a.classList.add("classically-controlled-zero"),a.classList.remove("classically-controlled-one"),null==l||l.classList.remove("hidden"),null==o||o.classList.add("hidden");break;case"0":r.childNodes[0].nodeValue="?",a.classList.add("classically-controlled-unknown"),a.classList.remove("classically-controlled-zero"),a.classList.remove("classically-controlled-one"),null==l||l.classList.remove("hidden"),null==o||o.classList.remove("hidden")}e.stopPropagation()}}))})),t},t.prototype.addZoomHandlers=function(t,e){var n=this;t.querySelectorAll(".gate .gate-control").forEach((function(r){r.addEventListener("click",(function(a){var i,l=null===(i=r.parentElement)||void 0===i?void 0:i.getAttribute("data-id");"string"==typeof l&&(r.classList.contains("gate-collapse")?n.collapseOperation(e.operations,l):r.classList.contains("gate-expand")&&n.expandOperation(e.operations,l),n.renderCircuit(t,e),a.stopPropagation())}))}))},t.prototype.expandOperation=function(t,e){var n=this;t.forEach((function(t){if(t.conditionalRender===o.ConditionalRender.AsGroup&&n.expandOperation(t.children||[],e),null==t.dataAttributes)return t;t.dataAttributes.id===e&&null!=t.children&&(t.conditionalRender=o.ConditionalRender.AsGroup,t.dataAttributes.expanded="true")}))},t.prototype.collapseOperation=function(t,e){var n=this;t.forEach((function(t){if(t.conditionalRender===o.ConditionalRender.AsGroup&&n.collapseOperation(t.children||[],e),null==t.dataAttributes)return t;var r=t.dataAttributes.id;r.startsWith(e)&&(t.conditionalRender=o.ConditionalRender.Always),r===e&&delete t.dataAttributes.expanded}))},t}();e.Sqore=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._qubitInput=e.formatInputs=void 0;var r=n(2),a=n(0);e.formatInputs=function(t){var e=[],n={},l=a.startY;return t.forEach((function(t){var o=t.id,s=t.numChildren;e.push(i(l)),n[o]={type:r.RegisterType.Qubit,y:l},null!=s&&0!==s?(l+=a.classicalRegHeight,n[o].children=Array.from(Array(s),(function(){var t={type:r.RegisterType.Classical,y:l};return l+=a.classicalRegHeight,t}))):l+=a.registerHeight})),{qubitWires:e.join("\n"),registers:n,svgHeight:l}};var i=function(t){return'<text x="'+a.leftPadding+'" y="'+t+'" dominant-baseline="middle" text-anchor="start">|0‚ü©</text>'};e._qubitInput=i},function(t,e,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),a=0;for(e=0;e<n;e++)for(var i=arguments[e],l=0,o=i.length;l<o;l++,a++)r[a]=i[l];return r};Object.defineProperty(e,"__esModule",{value:!0}),e._gateControls=e._classicalControlled=e._groupedOperations=e._controlledGate=e._swap=e._unitary=e._measure=e._createGate=e._formatGate=e.formatGates=void 0;var a=n(1),i=n(0),l=n(3),o=function(t,e){return void 0===e&&(e=0),t.map((function(t){return u(t,e)})).flat().join("\n")};e.formatGates=o;var s=function(t,e){if(null==t)return[];var n=b(t,e),r=n[0],a=n[1],i=t.dataAttributes||{},o=[];return"expanded"in i?o.push(l.group(['<circle cx="0" cy="0" r="10" />','<path d="M-7,0 H7" />'],{class:"gate-control gate-collapse",transform:"translate("+(r+2)+", "+(a+2)+")"})):"true"==i["zoom-in"]&&o.push(l.group(['<circle cx="0" cy="0" r="10" />','<path d="M0,-7 V7 M-7,0 H7" />'],{class:"gate-control gate-expand",transform:"translate("+(r+2)+", "+(a+2)+")"})),o};e._gateControls=s;var c=function(t,e,n){var r=s(e,n),a=(e||{}).dataAttributes,i={class:"gate"};return Object.entries(a||{}).forEach((function(t){var e=t[0],n=t[1];return i["data-"+e]=n})),l.group(t.concat(r),i)};e._createGate=c;var u=function(t,e){void 0===e&&(e=0);var n=t.type,r=t.x,i=t.controlsY,l=t.targetsY,o=t.label,s=t.displayArgs,u=t.width;switch(n){case a.GateType.Measure:return c([d(r,i[0])],t,e);case a.GateType.Unitary:return c([p(o,r,l,u,s)],t,e);case a.GateType.X:return c([h(t,e)],t,e);case a.GateType.Swap:return i.length>0?v(t,e):c([g(t,e)],t,e);case a.GateType.Cnot:case a.GateType.ControlledUnitary:return v(t,e);case a.GateType.Group:return m(t,e);case a.GateType.ClassicalControlled:return w(t);default:throw new Error("ERROR: unknown gate ("+o+") of type "+n+".")}};e._formatGate=u;var d=function(t,e){t-=i.minGateWidth/2;var n=i.minGateWidth,r=i.gateHeight;return[l.box(t,e-r/2,n,r,"gate-measure"),l.arc(t+5,e+2,n/2-5,r/2-8),l.line(t+n/2,e+8,t+n-8,e-r/2+8)].join("\n")};e._measure=d;var p=function(t,e,n,a,o,s){if(void 0===s&&(s=!0),0===n.length)return"";var c=n.map((function(n){var r=n[n.length-1],l=n[0],s=r-l+i.gateHeight;return f(t,e,l,a,s,o)}));if(s&&c.length>1){var u=n[n.length-1],d=n[0],p=u[u.length-1],g=d[0],h=l.dashedLine(e,g,e,p);return r([h],c).join("\n")}return c.join("\n")};e._unitary=p;var f=function(t,e,n,r,a,o){void 0===a&&(a=i.gateHeight);var s=(n-=i.gateHeight/2)+a/2-(null==o?0:7),c=[l.box(e-r/2,n,r,a),l.text(t,e,s)];if(null!=o){var u=n+a/2+8,d=l.text(o,e,u,i.argsFontSize);c.push(d)}return c.join("\n")},g=function(t,e){var n=t.x,r=t.targetsY,a=b(t,e),i=a[0],o=a[1],s=a[2],c=a[3],u=(null==r?void 0:r.flatMap((function(t){return t})))||[];return[l.box(i,o,s,c,"gate-swap"),u.map((function(t){return y(n,t)})),l.line(n,u[0],n,u[1])].join("\n")};e._swap=g;var h=function(t,e){var n=t.x,r=t.targetsY.flatMap((function(t){return t}));return x(n,r[0])},y=function(t,e){return[l.line(t-8,e-8,t+8,e+8),l.line(t-8,e+8,t+8,e-8)].join("\n")},v=function(t,e){var n=[],i=t.type,o=t.x,s=t.controlsY,u=t.label,d=t.displayArgs,f=t.width,g=t.targetsY;switch(i){case a.GateType.Cnot:g.forEach((function(t){return n.push(x(o,t))}));break;case a.GateType.Swap:g.forEach((function(t){return n.push(y(o,t))}));break;case a.GateType.ControlledUnitary:var h=g;n.push(p(u,o,h,f,d,!1)),g=g.flat();break;default:throw new Error("ERROR: Unrecognized gate: "+u+" of type "+i)}var v=s.map((function(t){return l.controlDot(o,t)})),b=Math.max.apply(Math,r(s,g)),m=Math.min.apply(Math,r(s,g)),w=l.line(o,m,o,b);return c(r([w],v,n),t,e)};e._controlledGate=v;var x=function(t,e,n){void 0===n&&(n=15);var r='<circle class="oplus" cx="'+t+'" cy="'+e+'" r="'+n+'"></circle>',a=l.line(t,e-n,t,e+n),i=l.line(t-n,e,t+n,e);return l.group([r,a,i],{class:"oplus"})},b=function(t,e){var n,r,l,o,s=t.x,c=t.width,u=t.type,d=t.targetsY,p=(null==d?void 0:d.flatMap((function(t){return t})))||[],f=Math.max.apply(Math,p),g=Math.min.apply(Math,p);switch(u){case a.GateType.Group:var h=i.groupBoxPadding-e*i.nestedGroupPadding;return[n=s-2*h,r=g-i.gateHeight/2-h,l=c+2*h,o=f+ +i.gateHeight/2+h-(g-i.gateHeight/2-h)];default:n=s-c/2,r=g-i.gateHeight/2,l=s+c,o=f+i.gateHeight/2}return[n,r,l,o]},m=function(t,e){var n=t.children,r=b(t,e),a=r[0],i=r[1],s=r[2],u=r[3],d=null!=n?o(n,e+1):"",p=l.dashedBox(a,i,s,u);return c([p,d],t,e)};e._groupedOperations=m;var w=function(t,e){void 0===e&&(e=i.groupBoxPadding);var n=t.controlsY,r=t.dataAttributes,a=t.targetsY,s=t.children,c=t.x,u=t.width,d=n[0],p=null!=s?o(s[0]):"";p='<g class="gates-zero">\r\n'+p+"</g>";var f=null!=s?o(s[1]):"";f='<g class="gates-one">\r\n'+f+"</g>";var g=c+i.controlBtnRadius,h=F(g,d),y=d+i.controlBtnRadius,v=d+i.classicalRegHeight/2,x=l.dashedLine(g,y,g,v,"classical-line");c+=i.controlBtnOffset;var b=l.dashedLine(g,v,c,v,"classical-line");u=u-i.controlBtnOffset+2*(e-i.groupBoxPadding),c+=i.groupBoxPadding-e;var m=a[0]-i.gateHeight/2-e,w=a[1]-a[0]+i.gateHeight+2*e,O=l.dashedBox(c,m,u,w,"classical-container"),_={class:"classically-controlled-group classically-controlled-unknown"};return null!=r&&Object.entries(r).forEach((function(t){var e=t[0],n=t[1];return _["data-"+e]=n})),l.group([b,x,h,p,f,O],_)};e._classicalControlled=w;var F=function(t,e,n){return void 0===n&&(n=i.controlBtnRadius),'<g class="classically-controlled-btn">\n<circle cx="'+t+'" cy="'+e+'" r="'+n+'"></circle>\n<text font-size="'+i.labelFontSize+'" x="'+t+'" y="'+e+'">?</text>\n</g>'}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._qubitRegister=e._classicalRegister=e.formatRegisters=void 0;var r=n(0),a=n(1),i=n(3);e.formatRegisters=function(t,e,n){var r=[];for(var i in t)r.push(o(Number(i),n,t[i].y));return e.forEach((function(t){var e=t.type,i=t.x,o=t.targetsY,s=t.controlsY;if(e===a.GateType.Measure){var c=s[0];o.forEach((function(t){r.push(l(i,c,n,t))}))}})),r.join("\n")};var l=function(t,e,n,r){return[i.line(t+1,e,t+1,r-1,"register-classical"),i.line(t-1,e,t-1,r+1,"register-classical"),i.line(t+1,r-1,n,r-1,"register-classical"),i.line(t-1,r+1,n,r+1,"register-classical")].join("\n")};e._classicalRegister=l;var o=function(t,e,n,a){void 0===a&&(a=16);var l=n-a;return[i.line(r.regLineStart,n,e,n),'<text x="'+r.regLineStart+'" y="'+l+'" dominant-baseline="hanging" text-anchor="start" font-size="75%">q'+t+"</text>"].join("\n")};e._qubitRegister=o},function(t,e,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),a=0;for(e=0;e<n;e++)for(var i=arguments[e],l=0,o=i.length;l<o;l++,a++)r[a]=i[l];return r};Object.defineProperty(e,"__esModule",{value:!0}),e._offsetChildrenX=e._fillMetadataX=e._splitTargetsY=e._getRegY=e._opToMetadata=e._getClassicalRegStart=e._alignOps=e._groupOperations=e.processOperations=void 0;var a=n(0),i=n(4),l=n(1),o=n(2),s=n(5),c=function(t,e){if(0===t.length)return{metadataList:[],svgWidth:a.startX};var n=u(t,e),i=d(n),o=Math.max.apply(Math,r([0],i.map((function(t){return t.length})))),s=new Array(o).fill(a.minGateWidth),c=p(t,i),g={},v=i.map((function(n){return n.map((function(n,r){var a=null;null==n||g.hasOwnProperty(n)||(a=t[n],g[n]=!0);var i=f(a,e);if(null!=a&&[l.GateType.Unitary,l.GateType.ControlledUnitary].includes(i.type)){var o=c.filter((function(t){var e=t[0];t[1];return e<=r})).map((function(t){t[0];var n=t[1];if(null==n.cId)throw new Error("Could not find cId for classical register.");var r=e[n.qId].children;if(null==r)throw new Error("Failed to find classical registers for qubit ID "+n.qId+".");return r[n.cId].y}));i.targetsY=h(a.targets,o,e)}return i.width>s[r]&&(s[r]=i.width),i}))})),x=y(v,s);return{metadataList:v.flat().filter((function(t){return t.type!=l.GateType.Invalid})),svgWidth:x}};e.processOperations=c;var u=function(t,e){var n=Math.max.apply(Math,r([-1],Object.keys(e).map(Number)))+1,a=Array.from(Array(n),(function(){return new Array(0)}));return t.forEach((function(t,e){var i=t.targets,l=t.controls||[],s=r(l,i).filter((function(t){return(t.type||o.RegisterType.Qubit)===o.RegisterType.Qubit})),c=s.map((function(t){return t.qId})),u=l.filter((function(t){return(t.type||o.RegisterType.Qubit)===o.RegisterType.Classical})).length>0;if(u||0!==s.length)for(var d=u?0:Math.min.apply(Math,c),p=u?n-1:Math.max.apply(Math,c),f=d;f<=p;f++)a[f].push(e)})),a};e._groupOperations=u;var d=function(t){for(var e=Math.max.apply(Math,r([0],t.map((function(t){return t.length})))),n=0,a=JSON.parse(JSON.stringify(t));n<e;){for(var i=function(t){var i=a[t];if(i.length<=n)return"continue";var l=i[n],o=a.map((function(t){return t.indexOf(l)})),s=Math.max.apply(Math,r([-1],o));n<s&&(a[t].splice(n,0,null),e=Math.max(e,a[t].length))},l=0;l<a.length;l++)i(l);n++}return a};e._alignOps=d;var p=function(t,e){var n=[];return e.forEach((function(e){for(var r=function(r){var a=e[r];null!=a&&t[a].isMeasurement&&t[a].targets.filter((function(t){return t.type===o.RegisterType.Classical})).forEach((function(t){return n.push([r,t])}))},a=0;a<e.length;a++)r(a)})),n};e._getClassicalRegStart=p;var f=function(t,e){var n={type:l.GateType.Invalid,x:0,controlsY:[],targetsY:[],label:"",width:-1};if(null==t)return n;var r=t.gate,o=t.dataAttributes,u=t.displayArgs,d=t.isMeasurement,p=t.isConditional,f=t.isControlled,h=t.isAdjoint,y=t.controls,v=t.targets,x=t.children,b=t.conditionalRender;if(n.controlsY=(null==y?void 0:y.map((function(t){return g(t,e)})))||[],n.targetsY=v.map((function(t){return g(t,e)})),p){if(null==x||0==x.length)throw new Error("No children operations found for classically-controlled operation.");var m=x.filter((function(t){return t.conditionalRender!==i.ConditionalRender.OnOne})),w=(T=c(m,e)).metadataList,F=T.svgWidth,O=x.filter((function(t){return t.conditionalRender!==i.ConditionalRender.OnZero})),_=(T=c(O,e)).metadataList,R=T.svgWidth,G=Math.max(F,R)-a.startX-2*a.gatePadding;n.type=l.GateType.ClassicalControlled,n.children=[w,_],n.width=G+a.controlBtnOffset+2*a.groupBoxPadding;var C=Object.values(e).map((function(t){return t.y}));C.length>0&&(n.targetsY=[Math.min.apply(Math,C),Math.max.apply(Math,C)])}else if(b==i.ConditionalRender.AsGroup&&((null==x?void 0:x.length)||0)>0){var T=c(x,e);n.type=l.GateType.Group,n.children=T.metadataList,n.width=T.svgWidth-a.startX+2*(a.groupBoxPadding-a.gatePadding)}else d?n.type=l.GateType.Measure:"SWAP"===r?n.type=l.GateType.Swap:f?(n.type="X"===r?l.GateType.Cnot:l.GateType.ControlledUnitary,n.label=r):"X"===r?(n.type=l.GateType.X,n.label=r):(n.type=l.GateType.Unitary,n.label=r);return h&&n.label.length>0&&(n.label+="'"),null!=u&&(n.displayArgs=u),n.width=s.getGateWidth(n),null!=o&&(n.dataAttributes=o),n};e._opToMetadata=f;var g=function(t,e){var n=t.type,r=t.qId,a=t.cId;if(!e.hasOwnProperty(r))throw new Error("ERROR: Qubit register with ID "+r+" not found.");var i=e[r],l=i.y,s=i.children;switch(n){case void 0:case o.RegisterType.Qubit:return l;case o.RegisterType.Classical:if(null==s)throw new Error("ERROR: No classical registers found for qubit ID "+r+".");if(null==a)throw new Error("ERROR: No ID defined for classical register associated with qubit ID "+r+".");if(s.length<=a)throw new Error("ERROR: Classical register ID "+a+" invalid for qubit ID "+r+" with "+s.length+" classical register(s).");return s[a].y;default:throw new Error("ERROR: Unknown register type "+n+".")}};e._getRegY=g;var h=function(t,e,n){if(0===t.length)return[];var r=Object.keys(n).map(Number);r.sort((function(t,e){return n[t].y-n[e].y}));var a={};r.forEach((function(t,e){return a[t]=e})),(t=t.slice()).sort((function(t,e){var n=a[t.qId]-a[e.qId];return 0===n&&null!=t.cId&&null!=e.cId?t.cId-e.cId:n})),(e=e.slice()).sort((function(t,e){return t-e}));var i=0,l=0;return t.reduce((function(t,r){var o=g(r,n),s=a[r.qId];for(0===t.length||s>i+1||e[0]>l&&e[0]<o?t.push([o]):t[t.length-1].push(o),i=s,l=o;e.length>0&&e[0]<=o;)e.shift();return t}),[])};e._splitTargetsY=h;var y=function(t,e){var n=a.startX,r=e.map((function(t){var e=n;return n+=t+2*a.gatePadding,e})),i=n;return t.forEach((function(t){return t.forEach((function(t,n){var i=r[n];switch(t.type){case l.GateType.ClassicalControlled:case l.GateType.Group:var o=i-a.startX+a.groupBoxPadding;t.type===l.GateType.ClassicalControlled&&(o+=a.controlBtnOffset),v(t.children,o),t.x=i;break;default:t.x=i+e[n]/2}}))})),i};e._fillMetadataX=y;var v=function(t,e){null!=t&&t.flat().forEach((function(t){t.x+=e,v(t.children,e)}))};e._offsetChildrenX=v}])}));
//# sourceMappingURL=qviz.min.js.map