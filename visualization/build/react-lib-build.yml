parameters:
  - name: jslib
    type: string
  - name: rootDirectory
    type: string
  - name: project
    type: string
  - name: reactnodemodules
    type: string
  - name: tests
    type: string
  - name: projectname
    type: string
  - name: outputDirectory
    type: string

#To do: remove "condition: succeeded or failed"
steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "16.x"
    displayName: "Install Node.js"

  - script: |
      npm install
      npm run build
    workingDirectory: "${{ parameters.project }}"
    displayName: "npm install and build react-lib"

  # To DO: add back in
  # - task: Npm@1
  #   displayName: npm run tests (react-lib)
  #   inputs:
  #     workingDir: "${{ parameters.project }}"
  #     command: "custom"
  #     customCommand: "run tests"

  # - task: PublishTestResults@2
  #   displayName: "Publish Test Results (react-lib)"
  #   condition: succeededOrFailed()
  #   continueOnError: true
  #   inputs:
  #     testResultsFiles: "${{ parameters.tests }}/test-results.xml"

  # - task: PublishCodeCoverageResults@1
  #   displayName: "Publish Code Coverage Results (react-lib)"
  #   continueOnError: true
  #   condition: succeededOrFailed()
  #   inputs:
  #     codeCoverageTool: "cobertura"
  #     summaryFileLocation: "${{ parameters.project }}/coverage/cobertura-coverage.xml"

  - task: Bash@3
    displayName: "Build js-lib and dependencies"
    condition: succeededOrFailed()
    inputs:
      targetType: "filePath"
      filePath: "${{ parameters.rootDirectory }}/build/build-jslib.sh"
      failOnStderr: true
      workingDirectory: "${{ parameters.rootDirectory }}/build/"

  - task: CopyFiles@2
    condition: succeededOrFailed()
    inputs:
      SourceFolder: "${{ parameters.jslib}}/dist/"
      Contents: "**"
      TargetFolder: "${{ parameters.outputDirectory }}"
    displayName: "Copy build artifacts to output directory"

  # - task: PublishPipelineArtifact@1
  #   inputs:
  #     targetPath: ${{ parameters.outputDirectory }}"
  #     artifactType: "pipeline"
  #     artifactName: "drop"
