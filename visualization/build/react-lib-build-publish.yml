parameters:
  - name: jslib
    type: string
  - name: rootDirectory
    type: string
  - name: project
    type: string
  - name: reactnodemodules
    type: string
  - name: tests
    type: string
  - name: projectname
    type: string
  - name: outputDirectory
    type: string

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "16.x"
    displayName: "Install Node.js"

  - task: npmAuthenticate@0
    inputs:
      workingFile: "${{ parameters.project }}/.npmrc"
    displayName: "npm authenticate"

  - script: |
      npm install
      npm run build
    workingDirectory: "${{ parameters.project }}"
    displayName: "npm install and build react-lib"

  # TO DO Uncomment
  # - task: Npm@1
  #   displayName: npm run test
  #   inputs:
  #     workingDir: "${{ parameters.project }}"
  #     command: "custom"
  #     customCommand: "run tests"

  # - task: PublishTestResults@2
  #   displayName: "publish test results"
  #   condition: succeededOrFailed()
  #   inputs:
  #     testResultsFiles: "${{ parameters.tests }}/test-results.xml"

  # - task: PublishCodeCoverageResults@1
  #   displayName: "Publish Code Coverage Results"
  #   condition: succeededOrFailed()
  #   inputs:
  #     codeCoverageTool: "cobertura"
  #     summaryFileLocation: "${{ parameters.project }}/coverage/cobertura-coverage.xml"

  - task: Npm@1
    displayName: "Publish feed"
    inputs:
      command: publish
      publishRegistry: useFeed
      publishFeed: resource-estimator-visualization-js
